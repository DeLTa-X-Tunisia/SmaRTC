{"version":3,"file":"index.esm.js","sources":["../src/client.ts","../src/mesh-client.ts","../src/video-decoder.ts","../src/easy.ts","../src/types.ts","../src/utils.ts"],"sourcesContent":["/**\r\n * SmaRTC Client - Main WebRTC Client with Mesh Support\r\n * Handles connection, signaling, and peer management\r\n */\r\n\r\nimport * as signalR from '@microsoft/signalr';\r\nimport { encode, decode } from '@msgpack/msgpack';\r\nimport type {\r\n  ConnectionConfig,\r\n  ClientEvents,\r\n  PeerConnection,\r\n  SessionInfo,\r\n  SignalMessage,\r\n  QualityLevel\r\n} from './types';\r\n\r\nexport class SmaRTCClient {\r\n  private connection: signalR.HubConnection;\r\n  private config: ConnectionConfig;\r\n  private peers: Map<string, PeerConnection> = new Map();\r\n  private localStream?: MediaStream;\r\n  private eventHandlers: Map<keyof ClientEvents, Function[]> = new Map();\r\n  private sessionInfo?: SessionInfo;\r\n  private latencyMap: Map<string, number> = new Map();\r\n\r\n  constructor(config: ConnectionConfig) {\r\n    this.config = {\r\n      maxDirectPeers: 8,\r\n      enableMesh: true,\r\n      canRelay: false,\r\n      quality: 'medium' as any,\r\n      ...config\r\n    };\r\n\r\n    // Initialize SignalR connection with MessagePack protocol\r\n    this.connection = new signalR.HubConnectionBuilder()\r\n      .withUrl(`${config.serverUrl}/signalhub`)\r\n      .withHubProtocol(new signalR.JsonHubProtocol()) // MessagePack would be: .withHubProtocol(new signalR.MessagePackHubProtocol())\r\n      .withAutomaticReconnect({\r\n        nextRetryDelayInMilliseconds: () => 2000 // 2s retry\r\n      })\r\n      .configureLogging(signalR.LogLevel.Warning)\r\n      .build();\r\n\r\n    this.setupSignalRHandlers();\r\n  }\r\n\r\n  /**\r\n   * Connect to SmaRTC server and join session\r\n   */\r\n  async connect(localStream?: MediaStream): Promise<void> {\r\n    this.localStream = localStream;\r\n\r\n    try {\r\n      await this.connection.start();\r\n      console.log('‚úÖ Connected to SmaRTC server');\r\n\r\n      // Join session\r\n      await this.connection.invoke(\r\n        'JoinSession',\r\n        this.config.sessionId,\r\n        this.config.username\r\n      );\r\n\r\n      // Set relay capability if enabled\r\n      if (this.config.canRelay) {\r\n        await this.connection.invoke('SetRelayCapability', true);\r\n      }\r\n\r\n      this.emit('connected');\r\n      this.startHeartbeat();\r\n    } catch (error) {\r\n      console.error('‚ùå Connection failed:', error);\r\n      this.emit('error', error as Error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disconnect from server and close all peer connections\r\n   */\r\n  async disconnect(): Promise<void> {\r\n    // Leave session\r\n    if (this.connection.state === signalR.HubConnectionState.Connected) {\r\n      await this.connection.invoke('LeaveSession', this.config.sessionId);\r\n    }\r\n\r\n    // Close all peer connections\r\n    this.peers.forEach(peer => {\r\n      peer.connection.close();\r\n    });\r\n    this.peers.clear();\r\n\r\n    // Stop local stream\r\n    if (this.localStream) {\r\n      this.localStream.getTracks().forEach(track => track.stop());\r\n    }\r\n\r\n    // Disconnect SignalR\r\n    await this.connection.stop();\r\n\r\n    this.emit('disconnected');\r\n  }\r\n\r\n  /**\r\n   * Create peer connection for direct communication\r\n   */\r\n  async createPeerConnection(peerId: string): Promise<RTCPeerConnection> {\r\n    const config: RTCConfiguration = {\r\n      iceServers: this.config.iceServers || [\r\n        { urls: 'stun:stun.l.google.com:19302' },\r\n        { urls: `stun:${this.config.serverUrl.replace(/^https?:\\/\\//, '')}:3478` }\r\n      ]\r\n    };\r\n\r\n    const pc = new RTCPeerConnection(config);\r\n\r\n    // Add local stream tracks\r\n    if (this.localStream) {\r\n      this.localStream.getTracks().forEach(track => {\r\n        pc.addTrack(track, this.localStream!);\r\n      });\r\n    }\r\n\r\n    // Handle remote stream\r\n    pc.ontrack = (event) => {\r\n      console.log('üìπ Received remote stream from:', peerId);\r\n      this.emit('remote-stream', peerId, event.streams[0]);\r\n    };\r\n\r\n    // Handle ICE candidates\r\n    pc.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        this.sendSignal(peerId, {\r\n          type: 'ice-candidate',\r\n          from: this.config.username,\r\n          to: peerId,\r\n          data: event.candidate\r\n        });\r\n      }\r\n    };\r\n\r\n    // Connection state monitoring\r\n    pc.onconnectionstatechange = () => {\r\n      console.log(`Peer ${peerId} connection state:`, pc.connectionState);\r\n      \r\n      if (pc.connectionState === 'connected') {\r\n        this.measureLatency(peerId);\r\n      } else if (pc.connectionState === 'failed' || pc.connectionState === 'closed') {\r\n        this.peers.delete(peerId);\r\n      }\r\n    };\r\n\r\n    // Create data channel for signaling\r\n    const dataChannel = pc.createDataChannel('smartc-signals', {\r\n      ordered: true,\r\n      maxRetransmits: 3\r\n    });\r\n\r\n    this.setupDataChannel(peerId, dataChannel);\r\n\r\n    // Store peer connection\r\n    this.peers.set(peerId, {\r\n      peerId,\r\n      connection: pc,\r\n      dataChannel,\r\n      latency: 999,\r\n      isRelay: false\r\n    });\r\n\r\n    return pc;\r\n  }\r\n\r\n  /**\r\n   * Create and send WebRTC offer\r\n   */\r\n  async createOffer(peerId: string): Promise<void> {\r\n    const pc = await this.createPeerConnection(peerId);\r\n    const offer = await pc.createOffer();\r\n    await pc.setLocalDescription(offer);\r\n\r\n    this.sendSignal(peerId, {\r\n      type: 'offer',\r\n      from: this.config.username,\r\n      to: peerId,\r\n      data: offer\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle incoming WebRTC offer\r\n   */\r\n  async handleOffer(peerId: string, offer: RTCSessionDescriptionInit): Promise<void> {\r\n    const pc = await this.createPeerConnection(peerId);\r\n    await pc.setRemoteDescription(offer);\r\n\r\n    const answer = await pc.createAnswer();\r\n    await pc.setLocalDescription(answer);\r\n\r\n    this.sendSignal(peerId, {\r\n      type: 'answer',\r\n      from: this.config.username,\r\n      to: peerId,\r\n      data: answer\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle incoming WebRTC answer\r\n   */\r\n  async handleAnswer(peerId: string, answer: RTCSessionDescriptionInit): Promise<void> {\r\n    const peer = this.peers.get(peerId);\r\n    if (peer) {\r\n      await peer.connection.setRemoteDescription(answer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle incoming ICE candidate\r\n   */\r\n  async handleIceCandidate(peerId: string, candidate: RTCIceCandidateInit): Promise<void> {\r\n    const peer = this.peers.get(peerId);\r\n    if (peer) {\r\n      await peer.connection.addIceCandidate(candidate);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send signal through SignalR (fallback) or DataChannel (preferred)\r\n   */\r\n  private async sendSignal(targetPeerId: string, signal: SignalMessage): Promise<void> {\r\n    const peer = this.peers.get(targetPeerId);\r\n\r\n    // Try to send via DataChannel first (zero server cost!)\r\n    if (peer?.dataChannel?.readyState === 'open') {\r\n      const encoded = encode(signal) as Uint8Array;\r\n      peer.dataChannel.send(encoded as any);\r\n      return;\r\n    }\r\n\r\n    // Fallback to SignalR\r\n    await this.connection.invoke(\r\n      'SendSignal',\r\n      targetPeerId,\r\n      JSON.stringify(signal)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Setup SignalR event handlers\r\n   */\r\n  private setupSignalRHandlers(): void {\r\n    // User joined session\r\n    this.connection.on('UserJoined', (data: { username: string; connectionId: string }) => {\r\n      console.log('üë§ User joined:', data.username);\r\n      this.emit('peer-joined', data.connectionId);\r\n\r\n      // Initiate peer connection if under direct peer limit\r\n      if (this.peers.size < (this.config.maxDirectPeers || 8)) {\r\n        this.createOffer(data.connectionId);\r\n      }\r\n    });\r\n\r\n    // User left session\r\n    this.connection.on('UserLeft', (data: { username: string; connectionId: string }) => {\r\n      console.log('üëã User left:', data.username);\r\n      const peer = this.peers.get(data.connectionId);\r\n      if (peer) {\r\n        peer.connection.close();\r\n        this.peers.delete(data.connectionId);\r\n      }\r\n      this.emit('peer-left', data.connectionId);\r\n    });\r\n\r\n    // Receive WebRTC signal\r\n    this.connection.on('ReceiveSignal', async (fromPeer: string, signal: any) => {\r\n      const signalData: SignalMessage = typeof signal === 'string' ? JSON.parse(signal) : signal;\r\n\r\n      switch (signalData.type) {\r\n        case 'offer':\r\n          await this.handleOffer(fromPeer, signalData.data);\r\n          break;\r\n        case 'answer':\r\n          await this.handleAnswer(fromPeer, signalData.data);\r\n          break;\r\n        case 'ice-candidate':\r\n          await this.handleIceCandidate(fromPeer, signalData.data);\r\n          break;\r\n      }\r\n    });\r\n\r\n    // Mesh topology update\r\n    this.connection.on('MeshUpdate', (topology: any) => {\r\n      console.log('üï∏Ô∏è Mesh topology updated:', topology);\r\n      this.emit('mesh-update', topology);\r\n    });\r\n\r\n    // Relay promotion\r\n    this.connection.on('RelayPromotion', (isRelay: boolean) => {\r\n      console.log('üéñÔ∏è Relay status:', isRelay ? 'PROMOTED' : 'DEMOTED');\r\n      this.emit('relay-promotion', isRelay);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup data channel for P2P signaling\r\n   */\r\n  private setupDataChannel(peerId: string, channel: RTCDataChannel): void {\r\n    channel.onopen = () => {\r\n      console.log('üì° Data channel opened with:', peerId);\r\n    };\r\n\r\n    channel.onmessage = (event) => {\r\n      try {\r\n        const signal: SignalMessage = decode(new Uint8Array(event.data)) as any;\r\n        // Handle P2P signal without server\r\n        this.handleP2PSignal(peerId, signal);\r\n      } catch (error) {\r\n        console.error('Failed to decode P2P signal:', error);\r\n      }\r\n    };\r\n\r\n    channel.onerror = (error) => {\r\n      console.error('Data channel error:', error);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle P2P signal received via data channel\r\n   */\r\n  private async handleP2PSignal(fromPeer: string, signal: SignalMessage): Promise<void> {\r\n    // Forward to appropriate handler\r\n    switch (signal.type) {\r\n      case 'relay':\r\n        // Handle relay forwarding\r\n        const targetPeer = this.peers.get(signal.to);\r\n        if (targetPeer?.dataChannel?.readyState === 'open') {\r\n          const encoded = encode(signal) as Uint8Array;\r\n          targetPeer.dataChannel.send(encoded as any);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Measure latency to peer\r\n   */\r\n  private async measureLatency(peerId: string): Promise<void> {\r\n    const peer = this.peers.get(peerId);\r\n    if (!peer?.connection) return;\r\n\r\n    try {\r\n      const stats = await peer.connection.getStats();\r\n      stats.forEach((report: any) => {\r\n        if (report.type === 'candidate-pair' && report.state === 'succeeded') {\r\n          const rtt = report.currentRoundTripTime * 1000; // Convert to ms\r\n          peer.latency = rtt;\r\n          this.latencyMap.set(peerId, rtt);\r\n\r\n          // Report latency to server for mesh optimization\r\n          this.connection.invoke('UpdatePeerLatency', peerId, Math.round(rtt));\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to measure latency:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start heartbeat to keep connection alive\r\n   */\r\n  private startHeartbeat(): void {\r\n    setInterval(() => {\r\n      if (this.connection.state === signalR.HubConnectionState.Connected) {\r\n        this.connection.invoke('Heartbeat').catch(() => {\r\n          console.warn('Heartbeat failed');\r\n        });\r\n      }\r\n    }, 30000); // Every 30 seconds\r\n  }\r\n\r\n  /**\r\n   * Get session information\r\n   */\r\n  getSessionInfo(): SessionInfo | undefined {\r\n    return this.sessionInfo;\r\n  }\r\n\r\n  /**\r\n   * Get connected peers\r\n   */\r\n  getPeers(): PeerConnection[] {\r\n    return Array.from(this.peers.values());\r\n  }\r\n\r\n  /**\r\n   * Send custom message to specific peer via data channel\r\n   */\r\n  sendMessage(peerId: string, data: any): void {\r\n    const peer = this.peers.get(peerId);\r\n    if (peer?.dataChannel?.readyState === 'open') {\r\n      const message = { type: 'custom-message', data };\r\n      peer.dataChannel.send(JSON.stringify(message));\r\n    } else {\r\n      console.warn(`Cannot send message to ${peerId}: no open data channel`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcast message to all connected peers\r\n   */\r\n  broadcast(data: any): void {\r\n    this.peers.forEach((peer, peerId) => {\r\n      this.sendMessage(peerId, data);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get WebRTC stats for a specific peer\r\n   */\r\n  async getStats(peerId?: string): Promise<any> {\r\n    if (!peerId) {\r\n      // Return aggregated stats for all peers\r\n      const allStats: any[] = [];\r\n      for (const [id, peer] of this.peers) {\r\n        const stats = await peer.connection.getStats();\r\n        allStats.push({ peerId: id, stats });\r\n      }\r\n      return allStats;\r\n    }\r\n\r\n    const peer = this.peers.get(peerId);\r\n    if (!peer) return null;\r\n\r\n    const stats = await peer.connection.getStats();\r\n    const result: any = { latency: peer.latency, bitrate: 0, packetsLost: 0 };\r\n\r\n    stats.forEach((report: any) => {\r\n      if (report.type === 'inbound-rtp' && report.kind === 'video') {\r\n        result.bitrate = Math.round((report.bytesReceived * 8) / 1000); // kbps\r\n        result.packetsLost = report.packetsLost || 0;\r\n        result.jitter = report.jitter || 0;\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Change video quality dynamically\r\n   */\r\n  setQuality(quality: string): void {\r\n    this.config.quality = quality as any;\r\n    // Note: In production, this should trigger renegotiation\r\n    console.log(`Quality changed to: ${quality}`);\r\n  }\r\n\r\n  /**\r\n   * Event emitter helpers\r\n   */\r\n  on<K extends keyof ClientEvents>(event: K, handler: ClientEvents[K]): void {\r\n    if (!this.eventHandlers.has(event)) {\r\n      this.eventHandlers.set(event, []);\r\n    }\r\n    this.eventHandlers.get(event)!.push(handler as Function);\r\n  }\r\n\r\n  off<K extends keyof ClientEvents>(event: K, handler: ClientEvents[K]): void {\r\n    const handlers = this.eventHandlers.get(event);\r\n    if (handlers) {\r\n      const index = handlers.indexOf(handler as Function);\r\n      if (index > -1) {\r\n        handlers.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  private emit<K extends keyof ClientEvents>(event: K, ...args: any[]): void {\r\n    const handlers = this.eventHandlers.get(event);\r\n    if (handlers) {\r\n      handlers.forEach(handler => handler(...args));\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Adaptive Mesh Network Client\r\n * Handles intelligent peer routing and relay management\r\n */\r\n\r\nimport { SmaRTCClient } from './client';\r\nimport type { ConnectionConfig, PeerConnection, RoutingStrategy } from './types';\r\n\r\nexport class AdaptiveMeshClient extends SmaRTCClient {\r\n  private routingStrategy: RoutingStrategy = 'fullMesh' as any;\r\n  private relayNodes: Set<string> = new Set();\r\n  private directPeers: Set<string> = new Set();\r\n\r\n  constructor(config: ConnectionConfig) {\r\n    super({ ...config, enableMesh: true });\r\n    this.setupMeshHandlers();\r\n  }\r\n\r\n  /**\r\n   * Setup mesh-specific event handlers\r\n   */\r\n  private setupMeshHandlers(): void {\r\n    this.on('mesh-update', (topology: any) => {\r\n      this.routingStrategy = topology.strategy;\r\n      this.relayNodes = new Set(topology.relayNodes);\r\n      this.directPeers = new Set(topology.directPeers);\r\n\r\n      console.log('üï∏Ô∏è Mesh updated:', {\r\n        strategy: this.routingStrategy,\r\n        directPeers: this.directPeers.size,\r\n        relayNodes: this.relayNodes.size\r\n      });\r\n\r\n      this.optimizeConnections();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Optimize peer connections based on mesh topology\r\n   */\r\n  private async optimizeConnections(): Promise<void> {\r\n    const currentPeers = this.getPeers();\r\n\r\n    // Close connections not in direct peers list (if using relay strategy)\r\n    if (this.routingStrategy === 'relayBased') {\r\n      currentPeers.forEach(peer => {\r\n        if (!this.directPeers.has(peer.peerId) && !this.relayNodes.has(peer.peerId)) {\r\n          peer.connection.close();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Ensure connections to relay nodes\r\n    this.relayNodes.forEach(async relayId => {\r\n      const existingPeer = currentPeers.find(p => p.peerId === relayId);\r\n      if (!existingPeer) {\r\n        await this.createOffer(relayId);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get optimal routing path for a message\r\n   */\r\n  getRoutingPath(targetPeerId: string): string[] {\r\n    const peers = this.getPeers();\r\n    const directPeer = peers.find(p => p.peerId === targetPeerId);\r\n\r\n    if (directPeer) {\r\n      // Direct connection available\r\n      return [targetPeerId];\r\n    }\r\n\r\n    // Route through relay\r\n    const relayPeers = peers.filter(p => this.relayNodes.has(p.peerId));\r\n    if (relayPeers.length > 0) {\r\n      // Choose relay with lowest latency\r\n      const bestRelay = relayPeers.reduce((best, current) =>\r\n        current.latency < best.latency ? current : best\r\n      );\r\n      return [bestRelay.peerId, targetPeerId];\r\n    }\r\n\r\n    // No route available (fallback to server)\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Get current mesh statistics\r\n   */\r\n  getMeshStats() {\r\n    const peers = this.getPeers();\r\n    return {\r\n      strategy: this.routingStrategy,\r\n      totalPeers: peers.length,\r\n      directPeers: Array.from(this.directPeers).length,\r\n      relayNodes: Array.from(this.relayNodes).length,\r\n      averageLatency: peers.reduce((sum, p) => sum + p.latency, 0) / peers.length,\r\n      minLatency: Math.min(...peers.map(p => p.latency)),\r\n      maxLatency: Math.max(...peers.map(p => p.latency))\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Differential Video Decoder (Client-Side)\r\n * Decodes compressed video frames from SmaRTC server\r\n */\r\n\r\nexport class DifferentialVideoDecoder {\r\n  private previousFrame: ImageData | null = null;\r\n  private canvas: HTMLCanvasElement;\r\n  private ctx: CanvasRenderingContext2D;\r\n\r\n  constructor(width: number, height: number) {\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.ctx = this.canvas.getContext('2d')!;\r\n  }\r\n\r\n  /**\r\n   * Decode compressed frame\r\n   */\r\n  decode(compressedData: Uint8Array): ImageData {\r\n    const isKeyframe = compressedData[0] === 0xFF;\r\n\r\n    if (isKeyframe) {\r\n      return this.decodeKeyframe(compressedData);\r\n    } else {\r\n      return this.decodeDeltaFrame(compressedData);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decode keyframe (full frame)\r\n   */\r\n  private decodeKeyframe(data: Uint8Array): ImageData {\r\n    // Placeholder: In production, implement full decompression\r\n    const imageData = this.ctx.createImageData(this.canvas.width, this.canvas.height);\r\n    \r\n    // Simple RLE decompression (matches server encoder)\r\n    let dataIndex = 2; // Skip header\r\n    let pixelIndex = 0;\r\n\r\n    while (dataIndex < data.length && pixelIndex < imageData.data.length) {\r\n      if (data[dataIndex] === 0xFF) {\r\n        // RLE marker\r\n        const count = data[dataIndex + 1];\r\n        const value = data[dataIndex + 2];\r\n        for (let i = 0; i < count; i++) {\r\n          imageData.data[pixelIndex++] = value;\r\n        }\r\n        dataIndex += 3;\r\n      } else {\r\n        // Literal\r\n        imageData.data[pixelIndex++] = data[dataIndex++];\r\n      }\r\n    }\r\n\r\n    this.previousFrame = imageData;\r\n    return imageData;\r\n  }\r\n\r\n  /**\r\n   * Decode delta frame (only changes)\r\n   */\r\n  private decodeDeltaFrame(data: Uint8Array): ImageData {\r\n    if (!this.previousFrame) {\r\n      throw new Error('No previous frame for delta decoding');\r\n    }\r\n\r\n    // Clone previous frame\r\n    const imageData = this.ctx.createImageData(this.canvas.width, this.canvas.height);\r\n    imageData.data.set(this.previousFrame.data);\r\n\r\n    // Apply delta changes\r\n    let dataIndex = 1; // Skip header\r\n    const changedBlocks = (data[dataIndex] | (data[dataIndex + 1] << 8));\r\n    dataIndex += 2;\r\n\r\n    // Decode each changed block\r\n    for (let i = 0; i < changedBlocks; i++) {\r\n      const blockX = data[dataIndex++];\r\n      const blockY = data[dataIndex++];\r\n      \r\n      // Decode block data (simplified)\r\n      // In production: implement full block decode with dequantization\r\n      const blockSize = 8;\r\n      const startIdx = (blockY * blockSize * this.canvas.width + blockX * blockSize) * 4;\r\n      \r\n      // Read compressed block data\r\n      // ... (implementation details)\r\n    }\r\n\r\n    this.previousFrame = imageData;\r\n    return imageData;\r\n  }\r\n\r\n  /**\r\n   * Get decoded frame as canvas element\r\n   */\r\n  getCanvas(): HTMLCanvasElement {\r\n    return this.canvas;\r\n  }\r\n\r\n  /**\r\n   * Render decoded frame to target canvas\r\n   */\r\n  renderTo(targetCanvas: HTMLCanvasElement): void {\r\n    const targetCtx = targetCanvas.getContext('2d')!;\r\n    targetCtx.drawImage(this.canvas, 0, 0, targetCanvas.width, targetCanvas.height);\r\n  }\r\n}\r\n","/**\r\n * SmaRTC Easy API - Simplified wrapper for quick integration\r\n * Zero boilerplate, maximum productivity\r\n */\r\n\r\nimport { SmaRTCClient } from './client';\r\nimport type { ConnectionConfig, ClientEvents } from './types';\r\n\r\nexport interface EasyConfig {\r\n  serverUrl: string;\r\n  roomId: string;\r\n  userName?: string;\r\n  videoQuality?: 'low' | 'medium' | 'high';\r\n  audioOnly?: boolean;\r\n  autoJoin?: boolean;\r\n}\r\n\r\nexport interface EasyCallbacks {\r\n  onReady?: () => void;\r\n  onPeerJoined?: (peerId: string) => void;\r\n  onPeerLeft?: (peerId: string) => void;\r\n  onRemoteStream?: (peerId: string, stream: MediaStream) => void;\r\n  onError?: (error: Error) => void;\r\n  onDisconnected?: () => void;\r\n}\r\n\r\n/**\r\n * Easy API - Simplified SmaRTC client\r\n * Perfect for quick prototypes and simple use cases\r\n */\r\nexport class SmaRTCEasy {\r\n  private client: SmaRTCClient;\r\n  private localStream?: MediaStream;\r\n  private config: EasyConfig;\r\n  private callbacks: EasyCallbacks;\r\n\r\n  constructor(config: EasyConfig, callbacks: EasyCallbacks = {}) {\r\n    this.config = {\r\n      userName: `User-${Math.random().toString(36).substr(2, 5)}`,\r\n      videoQuality: 'medium',\r\n      audioOnly: false,\r\n      autoJoin: false,\r\n      ...config\r\n    };\r\n\r\n    this.callbacks = callbacks;\r\n\r\n    // Create underlying client\r\n    const clientConfig: ConnectionConfig = {\r\n      serverUrl: this.config.serverUrl,\r\n      sessionId: this.config.roomId,\r\n      username: this.config.userName!,\r\n      quality: this.config.videoQuality as any, // Type conversion for enum\r\n      enableMesh: true,\r\n      maxDirectPeers: 8\r\n    };\r\n\r\n    this.client = new SmaRTCClient(clientConfig);\r\n    this.setupEventHandlers();\r\n\r\n    // Auto-join if requested\r\n    if (this.config.autoJoin) {\r\n      this.join().catch(error => {\r\n        console.error('Auto-join failed:', error);\r\n        callbacks.onError?.(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Join the room (starts camera/mic and connects)\r\n   */\r\n  async join(): Promise<void> {\r\n    try {\r\n      // Get media\r\n      this.localStream = await navigator.mediaDevices.getUserMedia({\r\n        video: !this.config.audioOnly ? {\r\n          width: { ideal: this.getVideoWidth() },\r\n          height: { ideal: this.getVideoHeight() }\r\n        } : false,\r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true\r\n        }\r\n      });\r\n\r\n      // Connect\r\n      await this.client.connect(this.localStream);\r\n    } catch (error) {\r\n      console.error('Failed to join:', error);\r\n      this.callbacks.onError?.(error as Error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Leave the room (disconnects and stops camera/mic)\r\n   */\r\n  async leave(): Promise<void> {\r\n    if (this.localStream) {\r\n      this.localStream.getTracks().forEach(track => track.stop());\r\n      this.localStream = undefined;\r\n    }\r\n\r\n    await this.client.disconnect();\r\n  }\r\n\r\n  /**\r\n   * Get local media stream\r\n   */\r\n  getLocalStream(): MediaStream | undefined {\r\n    return this.localStream;\r\n  }\r\n\r\n  /**\r\n   * Toggle video on/off\r\n   */\r\n  toggleVideo(enabled?: boolean): boolean {\r\n    if (!this.localStream) return false;\r\n\r\n    const videoTracks = this.localStream.getVideoTracks();\r\n    if (videoTracks.length === 0) return false;\r\n\r\n    const newState = enabled ?? !videoTracks[0].enabled;\r\n    videoTracks.forEach(track => track.enabled = newState);\r\n    return newState;\r\n  }\r\n\r\n  /**\r\n   * Toggle audio on/off\r\n   */\r\n  toggleAudio(enabled?: boolean): boolean {\r\n    if (!this.localStream) return false;\r\n\r\n    const audioTracks = this.localStream.getAudioTracks();\r\n    if (audioTracks.length === 0) return false;\r\n\r\n    const newState = enabled ?? !audioTracks[0].enabled;\r\n    audioTracks.forEach(track => track.enabled = newState);\r\n    return newState;\r\n  }\r\n\r\n  /**\r\n   * Change video quality\r\n   */\r\n  setQuality(quality: 'low' | 'medium' | 'high'): void {\r\n    this.config.videoQuality = quality;\r\n    // Note: Quality change requires re-negotiation in real implementation\r\n    console.warn('Quality change will take effect on next session');\r\n  }\r\n\r\n  /**\r\n   * Get list of connected peers\r\n   */\r\n  getPeers(): Array<{ id: string; latency: number }> {\r\n    return this.client.getPeers().map(peer => ({\r\n      id: peer.peerId,\r\n      latency: peer.latency\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get room statistics\r\n   */\r\n  getRoomStats(): {\r\n    totalPeers: number;\r\n    directConnections: number;\r\n    relayedConnections: number;\r\n    meshStrategy?: string;\r\n  } {\r\n    const sessionInfo = this.client.getSessionInfo();\r\n    const peers = this.client.getPeers();\r\n\r\n    return {\r\n      totalPeers: peers.length,\r\n      directConnections: peers.filter(p => !p.isRelay).length,\r\n      relayedConnections: peers.filter(p => p.isRelay).length,\r\n      meshStrategy: sessionInfo?.meshStrategy\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Send custom message to specific peer\r\n   */\r\n  sendMessageToPeer(peerId: string, message: any): void {\r\n    this.client.sendMessage(peerId, message);\r\n  }\r\n\r\n  /**\r\n   * Broadcast message to all peers\r\n   */\r\n  broadcast(message: any): void {\r\n    this.client.broadcast(message);\r\n  }\r\n\r\n  /**\r\n   * Listen for custom messages\r\n   */\r\n  onMessage(callback: (peerId: string, message: any) => void): void {\r\n    this.client.on('message', callback);\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private setupEventHandlers(): void {\r\n    this.client.on('connected', () => {\r\n      this.callbacks.onReady?.();\r\n    });\r\n\r\n    this.client.on('peer-joined', (peerId) => {\r\n      this.callbacks.onPeerJoined?.(peerId);\r\n    });\r\n\r\n    this.client.on('peer-left', (peerId) => {\r\n      this.callbacks.onPeerLeft?.(peerId);\r\n    });\r\n\r\n    this.client.on('remote-stream', (peerId, stream) => {\r\n      this.callbacks.onRemoteStream?.(peerId, stream);\r\n    });\r\n\r\n    this.client.on('error', (error) => {\r\n      this.callbacks.onError?.(error);\r\n    });\r\n\r\n    this.client.on('disconnected', () => {\r\n      this.callbacks.onDisconnected?.();\r\n    });\r\n  }\r\n\r\n  private getVideoWidth(): number {\r\n    switch (this.config.videoQuality) {\r\n      case 'low': return 640;\r\n      case 'medium': return 1280;\r\n      case 'high': return 1920;\r\n      default: return 1280;\r\n    }\r\n  }\r\n\r\n  private getVideoHeight(): number {\r\n    switch (this.config.videoQuality) {\r\n      case 'low': return 480;\r\n      case 'medium': return 720;\r\n      case 'high': return 1080;\r\n      default: return 720;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Quick helper function for ultra-simple integration\r\n * \r\n * @example\r\n * const room = await quickJoin('http://localhost:5000', 'my-room', {\r\n *   onRemoteStream: (peerId, stream) => {\r\n *     // Display remote video\r\n *   }\r\n * });\r\n */\r\nexport async function quickJoin(\r\n  serverUrl: string,\r\n  roomId: string,\r\n  callbacks: EasyCallbacks = {}\r\n): Promise<SmaRTCEasy> {\r\n  const client = new SmaRTCEasy(\r\n    { serverUrl, roomId, autoJoin: false },\r\n    callbacks\r\n  );\r\n\r\n  await client.join();\r\n  return client;\r\n}\r\n","/**\r\n * Type definitions for SmaRTC Zero-Cost SDK\r\n */\r\n\r\nexport interface ConnectionConfig {\r\n  serverUrl: string;\r\n  sessionId: string;\r\n  username: string;\r\n  enableMesh?: boolean;\r\n  canRelay?: boolean;\r\n  maxDirectPeers?: number;\r\n  iceServers?: RTCIceServer[];\r\n  codec?: 'vp8' | 'vp9' | 'h264';\r\n  quality?: QualityLevel;\r\n}\r\n\r\nexport enum QualityLevel {\r\n  VeryLow = 'veryLow',    // 144p, ~50kbps\r\n  Low = 'low',            // 240p, ~100kbps\r\n  Medium = 'medium',      // 360p, ~200kbps\r\n  High = 'high',          // 480p, ~400kbps\r\n  VeryHigh = 'veryHigh'   // 720p, ~800kbps\r\n}\r\n\r\nexport enum RoutingStrategy {\r\n  FullMesh = 'fullMesh',\r\n  Hybrid = 'hybrid',\r\n  RelayBased = 'relayBased'\r\n}\r\n\r\nexport interface PeerConnection {\r\n  peerId: string;\r\n  connection: RTCPeerConnection;\r\n  dataChannel?: RTCDataChannel;\r\n  latency: number;\r\n  isRelay: boolean;\r\n}\r\n\r\nexport interface SessionInfo {\r\n  sessionId: string;\r\n  participantCount: number;\r\n  totalPeers: number;\r\n  routingStrategy: RoutingStrategy;\r\n  meshStrategy?: string; // For backwards compatibility\r\n  relayNodeCount: number;\r\n  isRelayNode: boolean;\r\n}\r\n\r\nexport interface SignalMessage {\r\n  type: 'offer' | 'answer' | 'ice-candidate' | 'relay';\r\n  from: string;\r\n  to: string;\r\n  data: any;\r\n}\r\n\r\nexport interface MeshTopologyUpdate {\r\n  directPeers: string[];\r\n  relayNodes: string[];\r\n  strategy: RoutingStrategy;\r\n}\r\n\r\nexport interface MediaStats {\r\n  bandwidth: number;\r\n  packetsLost: number;\r\n  jitter: number;\r\n  roundTripTime: number;\r\n}\r\n\r\nexport interface ClientEvents {\r\n  'connected': () => void;\r\n  'disconnected': () => void;\r\n  'peer-joined': (peerId: string) => void;\r\n  'peer-left': (peerId: string) => void;\r\n  'remote-stream': (peerId: string, stream: MediaStream) => void;\r\n  'mesh-update': (topology: MeshTopologyUpdate) => void;\r\n  'quality-changed': (quality: QualityLevel) => void;\r\n  'relay-promotion': (isRelay: boolean) => void;\r\n  'stats': (stats: MediaStats) => void;\r\n  'error': (error: Error) => void;\r\n  'message': (peerId: string, data: any) => void;\r\n  'session-info': (info: SessionInfo) => void;\r\n}\r\n","/**\r\n * Utility functions for SmaRTC Client\r\n */\r\n\r\nexport function generateId(): string {\r\n  return Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function calculateBandwidth(bytes: number, durationMs: number): number {\r\n  return (bytes * 8) / (durationMs / 1000); // bits per second\r\n}\r\n\r\nexport function formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 Bytes';\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\r\n}\r\n\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: NodeJS.Timeout | null = null;\r\n  return (...args: Parameters<T>) => {\r\n    if (timeout) clearTimeout(timeout);\r\n    timeout = setTimeout(() => func(...args), wait);\r\n  };\r\n}\r\n\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle: boolean;\r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => (inThrottle = false), limit);\r\n    }\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}